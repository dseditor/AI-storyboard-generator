# AI 分鏡稿產生器

[English](README.md) | [繁體中文](README.zh-TW.md)

一個強大的 AI 驅動分鏡產生工具，可從文字描述創建包含圖片和影片的視覺分鏡稿。使用 React、Gemini API 和 ComfyUI 整合構建。
說明大多是ClaudeCode寫的，以下只有基本的功能參考。


## ✨ 功能特色

### 🎨 分鏡稿生成
- **AI 驅動腳本生成**：使用 Gemini 2.5 Flash 生成詳細的分鏡腳本
- **多種生成模式**：從 6 種創意模式中選擇
  - 👤 人物特寫
  - 🎬 人與場景
  - 📦 物件特寫
  - 📖 情境故事
  - ✨ 動畫風格
  - 🎨 自由創作
- **可自訂 Cut 數量**：生成任意數量的分鏡畫面
- **長寬比支援**：16:9 和 9:16 格式

### 🖼️ 圖片生成
- **雙重供應商支援**：
  - Gemini 2.5 Flash Image
  - ComfyUI 自訂工作流
- **圖片重新生成**：
  - 使用隨機種子重新生成單一圖片
  - 批次重新生成選中的圖片
  - 批次重新生成所有圖片
- **圖片選擇**：彩色標記的核取方塊系統（綠色）便於管理
- **種子隨機化**：每次重新生成都使用新的隨機種子以增加變化性

### 🎬 影片生成
- **ComfyUI 整合**：在鏡頭之間生成流暢的轉場影片
- **靈活的影片提示詞**：自訂動作和轉場描述
- **批次影片生成**：
  - 生成所有影片
  - 僅生成缺失的影片
  - 重新生成選中的影片
- **影片選擇**：彩色標記的核取方塊系統（藍色）便於管理
- **最後 Cut 支援**：自動處理最後一個 Cut 的單圖片模式

### 🎞️ 影片後製處理
- **FFmpeg 整合**：將所有影片合併為單一序列
- **影片預覽**：預覽個別影片或合併結果
- **影片下載**：下載個別或合併的影片
- **自動合併**：批次生成後自動合併影片

### 💾 專案管理
- **儲存專案**：將整個專案匯出為 ZIP（可選擇是否包含影片檔案）
- **載入專案**：匯入先前儲存的專案
- **追加專案**：依序合併多個專案
- **預設系統**：儲存和載入生成預設/範本

### 🎯 進階功能
- **圖片替換**：為任何 Cut 上傳自訂圖片
- **延伸修正**：使用前一個 Cut 作為參考以保持一致性
- **提示詞編輯**：內嵌編輯圖片和影片提示詞
- **Cut 管理**：新增、移除或重新排序 Cut
- **詳細檢視**：點擊任何 Cut 查看完整詳情和編輯選項
- **模型管理**：配置多個 AI 模型供應商
- **響應式設計**：支援桌面和行動裝置

## 🚀 開始使用

### 先決條件
- Node.js（v16 或更高版本）
- ComfyUI（選用，用於影片生成）
- Gemini API 金鑰

### 安裝步驟

1. 複製存儲庫：
\`\`\`bash
git clone https://github.com/dseditor/AI-storyboard-generator.git
cd AI-storyboard-generator
\`\`\`

2. 安裝相依套件：
\`\`\`bash
npm install
\`\`\`

3. 配置 API 金鑰：
   - 點擊應用程式中的 ⚙️ 設定按鈕
   - 輸入您的 Gemini API 金鑰
   - （選用）如果使用影片生成，請配置 ComfyUI 端點

4. 啟動開發伺服器：
\`\`\`bash
npm run dev
\`\`\`

5. 在瀏覽器中開啟 http://localhost:5173

### 建置正式版本

\`\`\`bash
npm run build
\`\`\`

建置檔案將位於 \`dist\` 目錄中。

## 🔧 配置設定

### 模型設定

應用程式支援多個 AI 模型供應商：

#### 語言模型（分鏡稿生成）
- **Gemini API**：使用 Gemini 2.5 Flash
- **OpenAI 相容 API**：任何 OpenAI 相容端點

#### 圖片模型
- **Gemini API**：使用 Gemini 2.5 Flash Image
- **ComfyUI**：自訂圖片生成工作流

#### 影片模型
- **ComfyUI**：配置工作流檔案和節點 ID
- **解析度**：可調整（預設：512x512）

### ComfyUI 設定

影片生成需要：
1. 在本地或伺服器上執行 ComfyUI
2. 相容的工作流（WanSE.json 或自訂）
3. 在設定中配置正確的節點 ID：
   - 開始影格節點
   - 結束影格節點
   - 提示詞節點
   - 儲存影片節點

## 📖 使用指南

### 基本工作流程

1. **上傳初始圖片**：點擊或拖曳圖片到上傳區域
2. **選擇長寬比**：選擇 16:9 或 9:16
3. **選擇生成模式**：從 6 種創意模式卡片中選擇
4. **輸入故事大綱**：描述您的故事或場景
5. **設定 Cut 數量**：指定分鏡畫面數量
6. **生成分鏡稿**：點擊「生成分鏡」按鈕
7. **生成影片**：點擊「生成影片」創建轉場
8. **合併影片**：將所有影片合併為最終序列

### 圖片重新生成

#### 單一圖片：
1. 點擊任何 Cut 卡片開啟詳細檢視
2. 點擊「🔄 重新生成圖片」按鈕
3. 使用不同種子生成新圖片

#### 批次重新生成：
1. 使用綠色核取方塊選擇圖片
2. 點擊「⚡ 重新生成選中圖片 (N)」按鈕
3. 或點擊「🎨 重新生成圖片（全部）」重新生成所有圖片

### 影片重新生成

#### 單一影片：
1. 開啟 Cut 詳細檢視
2. 如需要可編輯影片提示詞
3. 點擊重新生成按鈕

#### 批次重新生成：
1. 使用藍色核取方塊選擇影片
2. 點擊「⚡ 重新生成選中 (N)」按鈕
3. 或點擊「🔄 全部重新生成」重新生成所有影片

## 🏗️ 專案結構

\`\`\`
ai-storyboard-generator/
├── index.html              # 主要 HTML 檔案
├── index.tsx               # 主要 React 應用程式
├── index.css               # 樣式和動畫
├── ModelManagement.tsx     # 模型配置元件
├── ComfyUI/               # ComfyUI 工作流檔案
│   └── WanSE.json         # 影片生成工作流
├── package.json           # 相依套件
└── vite.config.ts         # Vite 配置
\`\`\`

## 🎨 UI 功能特色

### 現代化設計
- 具有漸層和動畫的彩色模式卡片
- 流暢的轉場和懸停效果
- 玻璃擬態效果
- 響應式網格佈局
- 深色主題優化

### 選擇系統
- **綠色核取方塊**：圖片選擇
- **藍色核取方塊**：影片選擇
- 圖片和影片的獨立選擇
- 兩種類型的批次操作

### 通知系統
- 應用程式內的浮動通知（非阻塞式）
- 成功/錯誤/資訊訊息類型
- 自動消失並帶有動畫
- 自訂確認對話框

## 🔌 API 整合

### Gemini API
- **使用的模型**：
  - \`gemini-2.5-flash\`：文字生成
  - \`gemini-2.5-flash-image\`：圖片生成
- **功能**：
  - JSON 模式進行結構化輸出
  - 回應結構驗證
  - 錯誤處理和重試邏輯

### ComfyUI API
- **使用的端點**：
  - \`/upload/image\`：上傳參考圖片
  - \`/prompt\`：佇列生成任務
  - \`/history/{prompt_id}\`：檢查完成狀態
  - \`/queue\`：監控佇列狀態
  - \`/view\`：下載生成的檔案
- **功能**：
  - 工作流自訂
  - 節點參數注入
  - 進度輪詢
  - 多輸出支援

## 🛠️ 技術堆疊

- **前端**：React 19、TypeScript、Vite
- **AI 服務**：Gemini API、ComfyUI
- **影片處理**：FFmpeg.wasm
- **檔案處理**：JSZip
- **樣式**：純 CSS 搭配 CSS 變數

## 📝 授權條款

MIT License - 詳見 LICENSE 檔案

## 🤝 貢獻

歡迎貢獻！請隨時提交 Pull Request。

## 📧 技術支援

如有問題和疑問，請在 GitHub 上開啟 issue。

## 🙏 致謝

- Google Gemini API 提供 AI 生成功能
- ComfyUI 提供圖片和影片生成
- FFmpeg 提供影片處理
- 開源社群

---

**使用 ❤️ 和 Claude Code 構建**
